{% extends 'admins/base.html' %}
{% load static %}

{% block content %}
<div id="layoutSidenav_content">
    <main>
        <div class="container-fluid">
            <h1 class="mt-4">Редактирование заказа | {{ order.id }}</h1>
            <div class="card-body">
                <form action="{% url 'admins:admins_order_update' order.id %}" method="post"
                      enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="form-group">
                        <label class="small mb-1" for="{{ form.status.id_for_label }}">Статус</label>
                        {{ form.status }}
                    </div>
                    <div class="order_form">
                        {{ form.as_p }}
                        <table class="table">
                            {{ orderitems.management_form }}
                            {% for form in orderitems.forms %}
                            {% if forloop.first %}
                            <thead>
                            <tr>
                                {% for field in form.visible_fields %}
                                <th class="{% cycle 'td1' 'td2' 'td3' %} order formset_td">
                                    {{ field.label|capfirst }}
                                </th>
                                {% endfor %}
                            </tr>
                            </thead>
                            {% endif %}
                            <tr class="formset_row">
                                {% for field in form.visible_fields %}
                                <td class="{% cycle 'td1' 'td2' 'td3' %} order formset_td">
                                    {% if forloop.first %}
                                        {% for hidden in form.hidden_fields %}
                                            {{ hidden }}
                                        {% endfor %}
                                    {% endif %}
                                    {{ field.errors.as_ul }}

                                    {% if field.name != 'price' %}
                                            {{ field }}
                                    {% else %}
                                    <span class="orderitems-{{ forloop.parentloop.counter0 }}-price">
                                            {{ field.value}} руб </span>
                                    {% endif %}


                                </td>
                                {% endfor %}
                            </tr>
                            {% endfor %}
                        </table>
                        <div class="col-lg-12" style="margin-top: 33px;">
                            <input class="btn btn-info btn-block" type="submit" value="Сохранить">
                        </div>
                </form>
                <div class="row">
                    <div class="col-lg-12" style="margin-top: 33px;">
                        <form action="{% url 'admins:admins_order_delete' order.id %}" method="post">
                            {% csrf_token %}
                            <input class="btn btn-danger btn-block" type="submit" value="Удалить">
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <footer class="py-4 bg-light mt-auto">
        <div class="container-fluid">
            <div class="d-flex align-items-center justify-content-between small">
                <div class="text-muted">Copyright &copy; GeekShop 2021</div>
            </div>
        </div>
    </footer>
</div>
{% endblock %}